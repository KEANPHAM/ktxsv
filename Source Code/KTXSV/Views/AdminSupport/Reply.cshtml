@model KTXSV.Models.SupportRequest

@{
    ViewBag.Title = "Phản hồi yêu cầu hỗ trợ";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<style>
    .btn-ee {
        background-color: #EE6823;
        color: #fff;
        border-radius: 8px;
    }

        .btn-ee:hover {
            background-color: #d85b1f;
            color: #fff;
        }

    .badge-status {
        font-size: 0.9rem;
        padding: 6px 10px;
        border-radius: 6px;
    }

    textarea {
        resize: vertical;
    }
</style>

<div class="container py-4">
    <h2 class="mb-4 fw-bold text-uppercase text-center">Phản hồi yêu cầu hỗ trợ</h2>

    <div class="card shadow-sm mb-4">
        <div class="card-body">
            <h5 class="card-title">@Model.Title</h5>
            <p class="mb-1"><strong>Người gửi:</strong> @(Model.User?.FullName ?? "Không rõ")</p>
            <p class="mb-1"><strong>Phòng:</strong> @(Model.Room?.RoomNumber ?? "Chưa có")</p>
            <p class="mb-1"><strong>Ngày tạo:</strong> @(Model.CreatedAt.HasValue ? Model.CreatedAt.Value.ToString("dd/MM/yyyy HH:mm") : "")</p>
            <p class="mb-1">
                <strong>Trạng thái hiện tại:</strong>
                @switch (Model.Status)
                {
                    case "Pending":
                        <span class="badge bg-warning text-dark badge-status">Chờ xử lý</span>; break;
                    case "Resolved":
                        <span class="badge bg-success badge-status">Đã xử lý</span>; break;
                    case "Rejected":
                        <span class="badge bg-danger badge-status">Từ chối</span>; break;
                    default:
                        <span class="badge bg-secondary badge-status">@Model.Status</span>; break;
                }
            </p>
            <p class="mt-3"><strong>Nội dung yêu cầu:</strong></p>
            <p class="border p-3 bg-light">@Html.Raw(Model.Description?.Replace("\n", "<br />"))</p>
        </div>
    </div>

    @using (Html.BeginForm("Reply", "AdminSupport", FormMethod.Post))
    {
        @Html.AntiForgeryToken()
        @Html.Hidden("id", Model.RequestID)

        <div class="mb-3">
            <label for="replyContent" class="form-label">Phản hồi của Admin:</label>
            <textarea id="replyContent" name="replyContent" class="form-control" rows="5" placeholder="Nhập phản hồi..."></textarea>
        </div>

        <div class="mb-3">
            <label for="newStatus" class="form-label">Cập nhật trạng thái:</label>
            @Html.DropDownList("newStatus", new SelectList(new[]
            {
                new { Value = "Pending", Text = "Chờ xử lý" },
                new { Value = "Resolved", Text = "Đã xử lý" },
                new { Value = "Rejected", Text = "Từ chối" }
            }, "Value", "Text", Model.Status), new { @class = "form-select" })
        </div>

        <button type="submit" class="btn btn-ee">Gửi phản hồi</button>
        @Html.ActionLink("Quay lại", "Index", null, new { @class = "btn btn-secondary ms-2" })
    }
</div>
